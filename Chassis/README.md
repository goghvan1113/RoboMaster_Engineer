## 全新出品的工程底盘代码

### 包括云台的总工程的代码目标

1. 操作手UI：当前工作模式显示（正常模式/救援/矿石模式）、电机状态的显示。
2. 半自动程序：小资源岛、兑换、空接流程（抬升、横移、等待抓取、收爪入矿）一键操作。
3. 操作手按键简单化。
4. 控制救援卡任务、救援爪任务、矿石任务、底盘全向移动任务、通信任务分别控制。
5. 救援卡与救援爪同时伸出；救援爪在有机器人阵亡时即可伸出，救援成功之后抬起。
6. 自动开局。（可选）

|            |            |              |              |          |            |        |              |      |
| ---------- | ---------- | ------------ | ------------ | -------- | ---------- | ------ | ------------ | ---- |
| 独立键位   | WASD       |              |              |          |            |        |              |      |
| 左半键盘区 | 底盘移动   | 抓取机构上下 | 抓取机构左右 | 旋转矿石 | 救援爪     | 救援卡 | 速度模式切换 |      |
| 组合键位   |            |              |              |          |            |        |              |      |
| shift/ctrl | 一键曲金矿 | 一键兑换     | 小资源岛一键 | 一键调头 | 一键初始化 |        |              |      |

### 命名规范！！

- 自定义文件夹统一采用全部**大写字母加下划线命名法**，如MOTOR_CONTROL。
- 自定义文件夹内的.c文件和.h文件采用想相同的**小写字母加下划线命名法**，如motor_control.c和motor_control.h。
- 文件内函数命名法采取**大驼峰命名法**，如SetChassisMotorCurrent()，适当添加下划线，有助于代码阅读。
- 文件内宏定义变量、枚举变量等一般采用**大写、下划线命名法**；其他变量依情况确定。

### C代码规范！！

- 消除extern。
- 文件注释，函数注释，变量注释。

### 底盘板用到的外设和引脚

STM32F40X LQFP64 pinout 封装

UASRT1(PA9、PA10)、DMA2_Stream7用于DMA串口打印；

CAN1(PA11、PA12)、CAN2(PB12、PB13)用于电机控制；



....

### 代码编写注意事项（更新中...)

- 由于带宽限制，CAN总线最多同时驱动7个电机。（官方说是8个）
- 底盘的运动PID在初始化时，前轮的积分限幅更小，由于前轮的启动更快。
- 全局变量可以重新写为**FreeRTOS信号量**的形式。
- 电调发送频率为1kHz，即接收电调返回数据时时最快1ms接收一次。
- 搭配电机性能曲线尽可能使电机的效率最高。

<img src="C:\Users\GF\AppData\Roaming\Typora\typora-user-images\image-20211029170218385.png" alt="image-20211029170218385" style="zoom: 25%;" />

<img src="C:\Users\GF\AppData\Roaming\Typora\typora-user-images\image-20211029170258049.png" alt="image-20211029170258049" style="zoom: 33%;" />

- PID参数整定时，KP越大过渡过程越快，静态偏差越小，但容易产生振荡；KI消除静态误差，降低系统的响应速度，增加系统的超调量；KD加快系统响应。

### 未进行重写部分

- 裁判系统，包括画图任务，接收处理数据任务。
- 矿石旋转机构的PID框架已经搭建，但未进行速度环和位置环的控制（可能会用一个2006）。
- 

